<section class="pc-wrap">
  <header class="pc-header">
    <h2>Pedidos de Compra</h2>
    <div class="actions">
      <button type="button" (click)="buscar()">Aplicar</button>
      <button type="button" class="ghost" (click)="limpar()">Limpar</button>
    </div>
  </header>

  <form [formGroup]="form" class="filtros" (ngSubmit)="buscar()">
    <div class="grid">
      <label> Status
        <select formControlName="status">
          <option value="">(todos)</option>
          <option value="AB">AB (Aberto)</option>
          <option value="AP">AP (Aprovado)</option>
          <option value="CA">CA (Cancelado)</option>
        </select>
      </label>

      <label> Fornecedor (ID)
        <input type="number" formControlName="fornecedor" />
      </label>

      <label> Fornecedor (contém)
        <input type="text" formControlName="q_fornecedor" />
      </label>

      <label> Loja (ID)
        <input type="number" formControlName="loja" />
      </label>

      <label> Documento (contém)
        <input type="text" formControlName="doc" />
      </label>

      <label> Emissão de
        <input type="date" formControlName="emissao_de" />
      </label>

      <label> Emissão até
        <input type="date" formControlName="emissao_ate" />
      </label>

      <label> Entrega de
        <input type="date" formControlName="entrega_de" />
      </label>

      <label> Entrega até
        <input type="date" formControlName="entrega_ate" />
      </label>

      <label> Total mín
        <input type="number" step="0.01" formControlName="total_min" />
      </label>

      <label> Total máx
        <input type="number" step="0.01" formControlName="total_max" />
      </label>
    </div>

    <div class="footer">
      <button type="submit">Aplicar filtros</button>
      <button type="button" class="ghost" (click)="limpar()">Limpar</button>
    </div>
  </form>

  <div class="state" *ngIf="carregando()">Carregando...</div>
  <div class="state err" *ngIf="erro()">{{ erro() }}</div>
  <div class="state" *ngIf="!carregando() && !erro() && rows().length === 0">Nenhum pedido encontrado.</div>

  <div class="table-wrap" *ngIf="rows().length > 0">
    <table>
      <thead>
        <tr>
          <th (click)="setOrdenacao('Datapedido')">Data do Pedido</th>
          <th (click)="setOrdenacao('Dataentrega')">Data de Entrega</th>
          <th (click)="setOrdenacao('Idpedidocompra')">Nº</th>
          <th (click)="setOrdenacao('Idfornecedor__Nome_fornecedor')">Fornecedor</th>
          <th (click)="setOrdenacao('Status')">Status</th>
          <th (click)="setOrdenacao('Valorpedido')">Total</th>
          <th>Loja</th>
          <th>Documento</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of rows()">
          <td>{{ p.Datapedido | date:'dd/MM/yyyy' }}</td>
          <td>{{ p.Dataentrega | date:'dd/MM/yyyy' }}</td>
          <td>{{ p.Idpedidocompra }}</td>
          <td>{{ p.fornecedor_nome }}</td>
          <td>{{ p.Status }}</td>
          <td>{{ p.Valorpedido | number:'1.2-2' }}</td>
          <td>{{ p.loja_nome }}</td>
          <td>{{ p.Documento }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
